---
layout:     post
title:      ã€Šç‰¹å¾å·¥ç¨‹å…¥é—¨ä¸å®è·µã€‹
subtitle:   book&reference
date:       2020-03-26
author:     Young
header-img: img/bg-post/1*EbpKczfURCvAF6uUp_Hhew.jpeg
catalog: true
tags:
    - book
---

> ç‰¹å¾å·¥ç¨‹ï¼ˆfeature engineeringï¼‰æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼šå°†æ•°æ®è½¬æ¢ä¸ºèƒ½æ›´å¥½åœ°è¡¨ç¤ºæ½œ åœ¨é—®é¢˜çš„ç‰¹å¾ï¼Œä»è€Œæé«˜æœºå™¨å­¦ä¹ æ€§èƒ½ã€‚

## ç‰¹å¾ç†è§£ï¼šæˆ‘çš„æ•°æ®é›†é‡Œæœ‰ä»€ä¹ˆ?

> æœ¬ç« æ¦‚è¦ï¼š
>
> 1ï¼‰ç»“æ„åŒ–æ•°æ®ä¸éç»“æ„åŒ–æ•°æ®ï¼› 
> 2ï¼‰å®šé‡æ•°æ®ä¸å®šæ€§æ•°æ®ï¼›
> 3ï¼‰æ•°æ®çš„ 4 ä¸ªç­‰çº§ï¼› 
> 4ï¼‰æ¢ç´¢æ€§æ•°æ®åˆ†æå’Œæ•°æ®å¯è§†åŒ–ï¼› 
> 5ï¼‰æè¿°æ€§ç»Ÿè®¡ã€‚

### 1ï¼‰æ•°æ®ç»“æ„çš„æœ‰æ— 

- **ç»“æ„åŒ–ï¼ˆæœ‰ç»„ç»‡ï¼‰æ•°æ®**ï¼šå¯ä»¥åˆ†æˆè§‚å¯Ÿå€¼å’Œç‰¹å¾çš„æ•°æ®ï¼Œä¸€èˆ¬ä»¥è¡¨æ ¼çš„å½¢å¼ç»„ç»‡ï¼ˆè¡Œæ˜¯ è§‚å¯Ÿå€¼ï¼Œåˆ—æ˜¯ç‰¹å¾ï¼‰ã€‚
- **éç»“æ„åŒ–ï¼ˆæ— ç»„ç»‡ï¼‰æ•°æ®** ï¼šä½œä¸ºè‡ªç”±æµåŠ¨çš„å®ä½“ï¼Œä¸éµå¾ªæ ‡å‡†ç»„ç»‡ç»“æ„ï¼ˆä¾‹å¦‚è¡¨æ ¼ï¼‰çš„æ•°æ®ã€‚é€šå¸¸ï¼Œéç»“æ„åŒ–æ•°æ®åœ¨æˆ‘ä»¬çœ‹æ¥æ˜¯ä¸€å›¢æ•°æ®ï¼Œæˆ–åªæœ‰ä¸€ä¸ªç‰¹å¾ï¼ˆåˆ—ï¼‰ã€‚æ¯”å¦‚æœåŠ¡å™¨æ—¥å¿—ã€‚

### 2ï¼‰å®šé‡æ•°æ®å’Œå®šæ€§æ•°æ®

- **å®šé‡æ•°æ®**æœ¬è´¨ä¸Šæ˜¯æ•°å€¼ï¼Œåº”è¯¥æ˜¯è¡¡é‡æŸæ ·ä¸œè¥¿çš„æ•°é‡ã€‚

  - **åŒå‘¨æœ€é«˜å·¥èµ„**ï¼šå®šé‡åˆ—ï¼Œä»£è¡¨æŸä¸ªéƒ¨é—¨çš„å¹³å‡æœ€é«˜å·¥èµ„

    æ­¤åˆ—æ˜¯å®šé‡çš„ï¼Œå› ä¸ºå…¶ä¸­çš„å€¼æ˜¯æ•°ï¼Œä»£è¡¨æŸäººæ¯ä¸¤å‘¨çš„å·¥èµ„ï¼›æ•°æ®ç±»å‹æ˜¯æµ®ç‚¹æ•°ï¼Œå› ä¸ºè¿›è¡Œäº†å¼ºåˆ¶è½¬æ¢

- **å®šæ€§æ•°æ®**æœ¬è´¨ä¸Šæ˜¯ç±»åˆ«ï¼Œåº”è¯¥æ˜¯æè¿°æŸæ ·ä¸œè¥¿çš„æ€§è´¨ã€‚

  - **å·¥ä½œç§ç±»**ï¼šå·¥èµ„å¯¹åº”çš„éƒ¨é—¨

    **æ­¤åˆ—è‚¯å®šæ˜¯å®šæ€§çš„ï¼Œå› ä¸ºä»£ç ä»£è¡¨ä¸€ä¸ªéƒ¨é—¨ï¼Œè€Œä¸æ˜¯æ•°é‡**ï¼›æ•°æ®ç±»å‹æ˜¯å¯¹è±¡ï¼ŒPandas ä¼šæŠŠå­—ç¬¦ä¸²å½’ä¸ºæ­¤ç±»

```python
# æŸ¥çœ‹å‰å‡ è¡Œ 
salary_ranges.head()
# æŸ¥çœ‹æ•°æ®æœ‰å¤šå°‘è¡Œï¼Œæ˜¯å¦æœ‰ç¼ºå¤±å€¼ï¼Œä»¥åŠæ¯åˆ—çš„æ•°æ®ç±»å‹ 
		# object, int, floatç±»å‹
salary_ranges.info()
# å¦ä¸€ç§è®¡ç®—ç¼ºå¤±å€¼æ•°é‡çš„æ–¹æ³• 
salary_ranges.isnull().sum()
# æ˜¾ç¤ºæè¿°æ€§ç»Ÿè®¡ 
		# describe æ–¹æ³•é»˜è®¤æè¿°å®šé‡åˆ—
salary_ranges.describe() 
```

> hintğŸ’¡
>
> - å½“å¤„ç†å®šé‡æ•°æ®æ—¶ï¼Œä¸€ èˆ¬ä½¿ç”¨æ•´æ•°æˆ–æµ®ç‚¹æ•°ä½œä¸ºç±»å‹ï¼ˆæœ€å¥½ä½¿ç”¨æµ®ç‚¹æ•°ï¼‰ï¼›å®šæ€§æ•°æ®åˆ™ä¸€èˆ¬ä½¿ç”¨å­—ç¬¦ä¸²æˆ– Unicode å¯¹è±¡ã€‚
> - ä¸ºäº†è¿›ä¸€æ­¥ç ”ç©¶å®šé‡æ•°æ®å’Œå®šæ€§æ•°æ®ï¼Œæˆ‘ä»¬å¼€å§‹ç ”ç©¶æ•°æ®çš„ 4 ä¸ªç­‰çº§

### 3ï¼‰æ•°æ®çš„ 4 ä¸ªç­‰çº§

æˆ‘ä»¬å·²ç»å¯ä»¥å°†æ•°æ®åˆ†ä¸ºå®šé‡å’Œå®šæ€§çš„ï¼Œä½†æ˜¯è¿˜å¯ä»¥ç»§ç»­åˆ†ç±»ã€‚æ•°æ®çš„ 4 ä¸ªç­‰çº§æ˜¯ï¼š

- **å®šç±»ç­‰çº§ï¼ˆnominal levelï¼‰**

  - å®šç±»ç­‰çº§æ˜¯æ•°æ®çš„ç¬¬ä¸€ä¸ªç­‰çº§ï¼Œå…¶ç»“æ„æœ€å¼±ã€‚è¿™ä¸ªç­‰çº§çš„æ•°æ®**åªæŒ‰åç§°åˆ†ç±»**ã€‚*ä¾‹å¦‚ï¼Œè¡€å‹ï¼ˆAã€ Bã€O å’Œ AB å‹ï¼‰ã€åŠ¨ç‰©ç‰©ç§å’Œäººåã€‚è¿™äº›æ•°æ®éƒ½æ˜¯å®šæ€§çš„ã€‚å…¶ä»–çš„ä¾‹å­åŒ…æ‹¬ï¼šåœ¨ä¸Šé¢â€œæ—§é‡‘å±±å·¥ä½œå·¥èµ„â€çš„æ•°æ®é›†ä¸­ï¼Œå·¥ä½œç§ç±»å¤„äºå®šç±»ç­‰çº§*ï¼›

  > â­•ï¸ å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š
  >
  > 1ï¼‰å¯ä»¥ç”¨ Pandas çš„ value_counts æ–¹æ³•è¿›è¡Œè®¡æ•°ï¼Œå‡ºç°æœ€å¤šçš„å·¥ä½œç§ç±»æ˜¯ 00000ï¼Œæ„å‘³ç€è¿™ä¸ªç§ç±»æ˜¯ä¼—æ•°ï¼Œå³æœ€å¤šçš„ç±»åˆ«ï¼›
  >
  > 2ï¼‰å¯ä»¥ä½¿ç”¨æ¡å½¢å›¾å’Œé¥¼å›¾ã€‚

- **å®šåºç­‰çº§ï¼ˆordinal levelï¼‰**

  - å®šç±»ç­‰çº§ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šè¿›ä¸€æ­¥æ¢ç´¢çš„æ–¹æ³•ã€‚å’Œå®šç±»ç­‰çº§ä¸€æ ·ï¼Œ**å®šåºç­‰çº§çš„å¤©ç„¶æ•°æ®å±æ€§ä»ç„¶æ˜¯ç±»åˆ«**ï¼Œå³ä½¿ç”¨æ•°æ¥è¡¨ç¤ºç±»åˆ«ä¹Ÿæ˜¯å¦‚æ­¤ã€‚*ä¾‹å¦‚ï¼Œè€ƒè¯•çš„æˆç»©ï¼ˆFã€Dã€Cã€Bã€Aï¼‰ã€‚*

  > å®šåºç­‰çº§ç»§æ‰¿äº†å®šç±»ç­‰çº§çš„æ‰€æœ‰å±æ€§ï¼Œè€Œä¸”**æœ‰é‡è¦çš„é™„åŠ å±æ€§**:
  >
  > 1ï¼‰å®šåºç­‰çº§çš„æ•°æ®å¯ä»¥**è‡ªç„¶æ’åº** ï¼›
  >
  > 2ï¼‰è¿™æ„å‘³ç€ï¼Œ**å¯ä»¥è®¤ä¸ºåˆ—ä¸­çš„æŸäº›æ•°æ®æ¯”å…¶ä»–æ•°æ®æ›´å¥½æˆ–æ›´å¤§**ã€‚

  > â­•ï¸ å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š
  >
  > 1ï¼‰ä¸ä»…å¯ä»¥ç»§ç»­ä½¿ç”¨æ¡å½¢å›¾å’Œé¥¼å›¾ï¼Œ è€Œä¸”å› ä¸º**èƒ½æ’åºå’Œæ¯”è¾ƒï¼Œæ‰€ä»¥èƒ½è®¡ç®—ä¸­ä½æ•°å’Œç™¾åˆ†ä½æ•°**ã€‚å¯¹äºä¸­ä½æ•°å’Œç™¾åˆ†ä½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ **èŒå¶å›¾å’Œç®±çº¿å›¾**ã€‚
  >
  > 2ï¼‰*å¦‚æ•°æ®å­—å…¸æ‰€è¿°ï¼ŒQ7A_ART æ˜¯å…³äºè‰ºæœ¯å“å’Œå±•è§ˆçš„ã€‚å¯èƒ½çš„é€‰æ‹©æ˜¯ 0ã€1ã€2ã€3ã€4ã€5ã€6ï¼Œæ¯ä¸ªæ•°å­—éƒ½æœ‰å«ä¹‰ã€‚ç„¶è€Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œè™½ç„¶è¿™äº›å€¼æ˜¯æ•°ï¼Œ ä½†æ¯ä¸ªæ•°å…¶å®ä»£è¡¨çš„æ˜¯ç±»åˆ«ï¼Œæ‰€ä»¥è¯¥æ•°æ®æ˜¯å®šæ€§çš„ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯å±äºå®šåºç­‰çº§ã€‚å¦‚æœåˆ é™¤ 0 å’Œ 6 è¿™ä¸¤ä¸ªç±»åˆ«ï¼Œå‰©ä¸‹çš„ 5 ä¸ªæœ‰åºç±»åˆ«ç±»ä¼¼äºé¤å…çš„è¯„åˆ†ï¼š*
  >
  > ```python
  > # åªè€ƒè™‘ 1ï½5 
  > art_ratings = art_ratings[(art_ratings>=1) & (art_ratings<=5)]
  > # å°†å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸² 
  > art_ratings = art_ratings.astype(str)
  > ## ç°åœ¨å®šåºæ•°æ®çš„æ ¼å¼æ˜¯æ­£ç¡®çš„ï¼Œå¯ä»¥è¿›è¡Œå¯è§†åŒ–
  > ```

- **å®šè·ç­‰çº§ï¼ˆinterval levelï¼‰**

  - æˆ‘ä»¬å¼€å§‹åŠ å¤§ç«åŠ›äº†ã€‚**åœ¨å®šç±»å’Œå®šåºç­‰çº§ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¤„ç†å®šæ€§æ•°æ®ã€‚å³ä½¿å…¶å†…å®¹æ˜¯æ•°ï¼Œä¹Ÿä¸ä»£è¡¨çœŸå®çš„æ•°é‡ã€‚**åœ¨å®šè·ç­‰çº§ï¼Œæˆ‘ä»¬æ‘†è„±äº†è¿™ä¸ªé™åˆ¶ï¼Œå¼€å§‹ç ”ç©¶å®šé‡æ•°æ®ã€‚

  > **å·®å€¼ä¹Ÿå°†å˜å¾—æœ‰æ„ä¹‰**ï¼š**åœ¨å®šè·ç­‰çº§ï¼Œæ•°å€¼æ•°æ®ä¸ä»…å¯ä»¥åƒå®šåºç­‰çº§çš„æ•°æ®ä¸€æ ·æ’åºï¼Œè€Œä¸”å€¼ä¹‹é—´çš„å·®å¼‚ä¹Ÿæœ‰æ„ä¹‰ã€‚**è¿™æ„å‘³ç€ï¼Œåœ¨å®šè·ç­‰çº§ï¼Œ æˆ‘ä»¬ä¸ä»…å¯ä»¥å¯¹å€¼è¿›è¡Œ**æ’åºå’Œæ¯”è¾ƒï¼Œè€Œä¸”å¯ä»¥åŠ å‡**ã€‚*å¯¹æ¸©åº¦åšå·®å€¼ç ”ç©¶ç¾å›½ä» 18 ä¸–çºªè‡³ä»Šå¹³å‡æ¸©åº¦ä¸Šå‡å¤šå°‘è¿™ä¸ªé—®é¢˜*
  >
  > ```python
  > # ç”¨ groupby æ¸…é™¤å¹´ä»½çš„å¤§éƒ¨åˆ†å™ªå£°
  > climate_sub_us.groupby('year').mean()['AverageTemperature'].plot()
  > # ç”¨æ»‘åŠ¨å‡å€¼å¹³æ»‘å›¾åƒ
  > climate_sub_us.groupby('year').mean()['AverageTemperature'].rolling(10).mean().plot()
  > ## å¥½å¤šäº†ï¼å¯ä»¥çœ‹å‡ºæ°”æ¸©éšå¹´ä»½ä¸Šå‡çš„è¶‹åŠ¿
  > ```

  > â­•ï¸ å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š
  >
  > è¯·è®°ä½ï¼Œåœ¨å®šè·ç­‰çº§ä¸Šå¯ä»¥è¿›è¡ŒåŠ å‡ï¼Œè¿™æ”¹å˜äº†æ•´ä¸ªæ¸¸æˆè§„åˆ™ã€‚æ—¢ç„¶å¯ä»¥æŠŠå€¼åŠ åœ¨ä¸€èµ·ï¼Œå°± èƒ½å¼•å…¥ä¸¤ä¸ªç†Ÿæ‚‰çš„æ¦‚å¿µï¼š**ç®—æœ¯å¹³å‡æ•°ï¼ˆå°±æ˜¯å‡å€¼ï¼‰å’Œæ ‡å‡†å·®**ã€‚
  >
  > è½¬ç”¨**ç›´æ–¹å›¾å¯è§†åŒ–**ï¼šç›´æ–¹å›¾æ˜¯æ¡å½¢å›¾çš„â€œè¿‘äº²â€ï¼Œ**ç”¨ä¸åŒçš„æ¡¶åŒ…å«ä¸åŒçš„æ•°æ®**ï¼Œå¯¹æ•°æ®çš„é¢‘ç‡è¿›è¡Œå¯è§†åŒ–ã€‚

- **å®šæ¯”ç­‰çº§ï¼ˆratio levelï¼‰**

  - æœ€ç»ˆï¼Œæˆ‘ä»¬åˆ°è¾¾äº†æœ€é«˜çš„ç­‰çº§ï¼šå®šæ¯”ç­‰çº§ã€‚åœ¨è¿™ä¸ªç­‰çº§ä¸Šï¼Œå¯ä»¥è¯´æˆ‘ä»¬æ‹¥æœ‰æœ€é«˜ç¨‹åº¦çš„æ§åˆ¶å’Œæ•°å­¦è¿ç®—èƒ½åŠ›ã€‚å’Œå®šè·ç­‰çº§ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨å®šæ¯”ç­‰çº§ä¸Šå¤„ç†çš„ä¹Ÿæ˜¯å®šé‡æ•°æ®ã€‚è¿™é‡Œ**ä¸ä»…ç»§æ‰¿äº†å®šè·ç­‰çº§çš„åŠ å‡è¿ç®—ï¼Œè€Œä¸”æœ‰äº†ä¸€ä¸ªç»å¯¹é›¶ç‚¹çš„æ¦‚å¿µï¼Œå¯ä»¥åšä¹˜é™¤è¿ç®—**ã€‚

  > â­•ï¸ å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š
  >
  > åœ¨å®šæ¯”ç­‰çº§ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œ**ä¹˜é™¤è¿ç®—**ã€‚è™½ç„¶çœ‹èµ·æ¥æ²¡ä»€ä¹ˆå¤§ä¸äº†ï¼Œä½†æ˜¯è¿™äº›è¿ç®—å¯ä»¥è®©æˆ‘ä»¬ å¯¹è¿™ä¸ªç­‰çº§ä¸Šçš„æ•°æ®è¿›è¡Œç‹¬ç‰¹çš„è§‚å¯Ÿï¼Œè€Œè¿™åœ¨ä½ç­‰çº§ä¸Šæ˜¯æ— æ³•åšåˆ°çš„ã€‚*ä¾‹å¦‚ï¼Œå½“å¤„ç†é‡‘èæ•°æ®æ—¶ï¼Œæˆ‘ä»¬å‡ ä¹è‚¯å®šè¦è®¡ç®—ä¸€äº›è´§å¸çš„å€¼ã€‚è´§å¸å¤„äºå®šæ¯”ç­‰çº§ï¼Œå› ä¸ºâ€œé›¶èµ„é‡‘â€ è¿™ä¸ªæ¦‚å¿µå¯ä»¥å­˜åœ¨ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¯´ï¼š\$100 æ˜¯\$50 çš„ä¸¤å€ï¼Œå› ä¸º 100 / 50 = 2ï¼›å·¥èµ„æœ€é«˜çš„å‘˜å·¥æ¯”å·¥èµ„æœ€ä½çš„å‘˜å·¥å¤šèµšè¿‘ 13 å€ã€‚å¤šäºäº†å®šæ¯”ç­‰çº§ï¼Œæˆ‘ä»¬æ‰èƒ½çŸ¥é“è¿™ä»¶äº‹æƒ…ï¼*

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/lS9W57.png)

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/rYIp41.png)

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/XPAPl6.png)

## ç‰¹å¾å¢å¼ºï¼šæ¸…æ´—æ•°æ®

> æœ¬ç« æ¦‚è¦ï¼š
>
> 1ï¼‰è¯†åˆ«æ•°æ®ä¸­çš„ç¼ºå¤±å€¼ï¼› 
> 2ï¼‰åˆ é™¤æœ‰å®³æ•°æ®ï¼› 
> 3ï¼‰è¾“å…¥ï¼ˆå¡«å……ï¼‰ç¼ºå¤±å€¼ï¼› 
> 4ï¼‰å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–/æ ‡å‡†åŒ–ï¼› 
> 5ï¼‰æ„å»ºæ–°ç‰¹å¾ï¼› 
> 6ï¼‰æ‰‹åŠ¨æˆ–è‡ªåŠ¨é€‰æ‹©ï¼ˆç§»é™¤ï¼‰ç‰¹å¾ï¼› 
> 7ï¼‰ä½¿ç”¨æ•°å­¦çŸ©é˜µè®¡ç®—å°†æ•°æ®é›†è½¬æ¢åˆ°ä¸åŒçš„ç»´åº¦ã€‚

> æœ¬ç« å°†ä½¿ç”¨ä¹‹å‰å­¦åˆ°çš„çŸ¥è¯†ï¼Œå¹¶ä¸”å¼€å§‹è¿›ä¸€æ­¥ä¿®æ”¹æˆ‘ä»¬çš„æ•°æ®é›†ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†å¼€å§‹**æ¸…æ´—å’Œå¢å¼ºæ•°æ®**ï¼šå‰è€…æ˜¯æŒ‡**è°ƒæ•´å·²æœ‰çš„åˆ—å’Œè¡Œ**ï¼Œåè€…åˆ™æ˜¯æŒ‡**åœ¨æ•°æ®é›†ä¸­åˆ é™¤å’Œæ·»åŠ æ–°çš„åˆ—**ã€‚å’Œä»¥å¾€ ä¸€æ ·ï¼Œæ‰€æœ‰è¿™äº›æ“ä½œçš„ç›®æ ‡éƒ½æ˜¯ä¼˜åŒ–æœºå™¨å­¦ä¹ æµæ°´çº¿ã€‚è¿™äº›æ–¹æ³•ä¼šå¸®åŠ©æˆ‘ä»¬**æ›´å¥½åœ°äº†è§£æ•°æ®ä¸­çš„å“ªäº›ç‰¹å¾æ›´é‡è¦**ã€‚æœ¬ç« å°†æ·±å…¥è®¨è®ºå‰ 4 ç§æ–¹æ³•ï¼Œå 3 ç§æ–¹æ³•ç•™åˆ°ä¹‹åç« èŠ‚ä¸­è®¨è®ºã€‚
>
> æœ¬ç« åªå¤„ç†å®šé‡ç‰¹å¾ï¼Œå›  ä¸ºç›®å‰æ²¡æœ‰è¶³å¤Ÿçš„å·¥å…·å¤„ç†ç¼ºå¤±çš„å®šæ€§ç‰¹å¾ã€‚ä¸‹ä¸€ç« ä¼šç ”ç©¶ç‰¹å¾æ„å»ºï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### 1ï¼‰è¯†åˆ«æ•°æ®ä¸­çš„ç¼ºå¤±å€¼

- çš®é©¬å°ç¬¬å®‰äººç³–å°¿ç—…é¢„æµ‹æ•°æ®é›†

  (1) æ€€å­•æ¬¡æ•°ï¼›times_pregnant

  (2) å£æœè‘¡è„ç³–è€é‡è¯•éªŒä¸­çš„ 2 å°æ—¶è¡€æµ†è‘¡è„ç³–æµ“åº¦ï¼›plasma_glucose_concentration

  (3) èˆ’å¼ å‹ï¼ˆmmHgï¼‰ï¼›diastolic_blood_pressure

  (4) ä¸‰å¤´è‚Œçš®è¤¶åšåº¦ï¼ˆmmï¼‰ï¼›triceps_thickness

  (5) 2 å°æ—¶è¡€æ¸…èƒ°å²›ç´ æµ“åº¦ï¼ˆÎ¼U/mlï¼‰ï¼›serum_insulin

  (6) ä½“é‡æŒ‡æ•°ï¼»BMIï¼Œå³ä½“é‡ï¼ˆkgï¼‰é™¤ä»¥èº«é«˜ï¼ˆmï¼‰çš„å¹³æ–¹ï¼½ï¼›bmi

  (7) ç³–å°¿ç—…å®¶æ—å‡½æ•°ï¼›pedigree_function

  (8) å¹´é¾„ï¼ˆå²ï¼‰ï¼›age

  (9) ç±»å˜é‡ï¼ˆ0 æˆ– 1ï¼Œä»£è¡¨æ— æˆ–æœ‰ç³–å°¿ç—…ï¼‰ã€‚onset_diabetes

### 2ï¼‰æ¢ç´¢æ€§æ•°æ®åˆ†æ

```python
# å¯¼å…¥æ¢ç´¢æ€§æ•°æ®åˆ†ææ‰€éœ€çš„åŒ… 
import pandas as pd # å­˜å‚¨è¡¨æ ¼æ•°æ® 
import numpy as np # æ•°å­¦è®¡ç®—åŒ… 
import matplotlib.pyplot as plt # æµè¡Œçš„æ•°æ®å¯è§†åŒ–å·¥å…· 
import seaborn as sns # å¦ä¸€ä¸ªæµè¡Œçš„æ•°æ®å¯è§†åŒ–å·¥å…· 
%matplotlib inline 
plt.style.use('fivethirtyeight') # æµè¡Œçš„æ•°æ®å¯è§†åŒ–ä¸»é¢˜

pima['onset_diabetes'].value_counts(normalize=True)
>>> # ç©ºå‡†ç¡®ç‡ï¼Œ65%çš„äººæ²¡æœ‰ç³–å°¿ç—…

    0 0.651042 
    1 0.348958 
    Name: onset_diabetes, dtype: float64
```

> æ—¢ç„¶ç»ˆæç›®æ ‡æ˜¯ç ”ç©¶æ•°æ®çš„è§„å¾‹ä»¥é¢„æµ‹æ˜¯å¦ä¼šæ‚£ç³–å°¿ç—…ï¼Œé‚£ä¹ˆå¯ä»¥å¯¹ç³–å°¿ç—…æ‚£è€…å’Œå¥åº·äººçš„ åŒºåˆ«è¿›è¡Œå¯è§†åŒ–ã€‚å¸Œæœ›ç›´æ–¹å›¾å¯ä»¥æ˜¾ç¤ºä¸€äº›è§„å¾‹ï¼Œæˆ–è€…è¿™ä¸¤ç±»ä¹‹é—´çš„æ˜¾è‘—å·®å¼‚ï¼š

```python
# å¯¹ plasma_glucose_concentration åˆ—ç»˜åˆ¶ä¸¤ç±»çš„ç›´æ–¹å›¾

col = 'plasma_glucose_concentration' 
plt.hist(pima[pima['onset_diabetes']==0][col], 10, alpha=0.5, label='non-diabetes') plt.hist(pima[pima['onset_diabetes']==1][col], 10, alpha=0.5, label='diabetes') plt.legend(loc='upper right') 
plt.xlabel(col) 
plt.ylabel('Frequency') 
plt.title('Histogram of {}'.format(col)) 
plt.show()
```

> â€¼ï¸ çœ‹èµ·æ¥æ‚£è€…å’Œå¸¸äººçš„è¡€æµ†è‘¡è„ç³–æµ“åº¦ï¼ˆplasma_glucose_concentrationï¼‰æœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚
>
> æˆ‘ä»¬ç»§ç»­æŒ‰æ­¤ç»˜åˆ¶å…¶ä»–åˆ—çš„ç›´æ–¹å›¾ï¼š

| <img src="/Users/yangjiale/Library/Application Support/typora-user-images/image-20200328222441490.png" alt="image-20200328222441490" style="zoom:33%;" /> | <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/BpWlqF.png" style="zoom:33%;" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/frMHPx.png" style="zoom:33%;" /> | <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/NHIO8n.png" style="zoom:33%;" /> |

> â€¼ï¸ **è§‚å¯Ÿå‡ å¼ ç›´æ–¹å›¾åï¼Œå¯ä»¥çœ‹å‡ºä¸¤ç±»äººå­˜åœ¨æ˜æ˜¾åŒºåˆ«**ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæœ€ç»ˆæ‚£æœ‰ç³–å°¿ç—…çš„æ‚£è€…ï¼Œå…¶ è¡€æµ†è‘¡è„ç³–æµ“åº¦ä¼šæœ‰å¾ˆå¤§çš„å¢é•¿ã€‚æˆ‘ä»¬**å¯ä»¥ç”¨çº¿æ€§ç›¸å…³çŸ©é˜µæ¥é‡åŒ–è¿™äº›å˜é‡é—´çš„å…³ç³»**ã€‚ç”¨æœ¬ç« ä¸€ å¼€å§‹å¯¼å…¥çš„ Seaborn ä½œä¸ºå¯è§†åŒ–å·¥å…·ï¼š

```python
# æ•°æ®é›†ç›¸å…³çŸ©é˜µçš„çƒ­åŠ›å›¾ 
sns.heatmap(pima.corr()) 
# plasma_glucose_concentration å¾ˆæ˜æ˜¾æ˜¯é‡è¦çš„å˜é‡

# æˆ‘ä»¬è¿›ä¸€æ­¥ç ”ç©¶ onset_diabetes åˆ—çš„ç›¸å…³æ€§æ•°å€¼
pima.corr()['onset_diabetes'] # ç›¸å…³çŸ©é˜µ

>>> times_pregnant 0.221898 
    plasma_glucose_concentration 0.466581  # plasma_glucose_concentration å¾ˆæ˜æ˜¾æ˜¯é‡è¦çš„å˜é‡
    diastolic_blood_pressure 0.065068 
    triceps_thickness 0.074752 
    serum_insulin 0.130548 
    bmi 0.292695 
    pedigree_function 0.173844 
    age 0.238356 
    onset_diabetes 1.000000 
    Name: onset_diabetes, dtype: float64
```

> ç¬¬ 4 ç« ä¼šè¿›ä¸€æ­¥ç ”ç©¶ç›¸å…³æ€§çš„å„ç§åŠŸèƒ½ï¼Œè€Œç›®å‰æ¢ç´¢æ€§æ•°æ®åˆ†ææç¤ºï¼Œ**plasma_glucose_ concentration æ˜¯é¢„æµ‹ç³–å°¿ç—…çš„é‡è¦å˜é‡**ã€‚

> ä¸‹ä¸€æ­¥æ›´é‡è¦ï¼šæˆ‘ä»¬è¦çœ‹çœ‹æ•°æ®é›†ä¸­æ˜¯å¦æœ‰æ•°æ®ç‚¹æ˜¯ç©ºçš„ï¼ˆç¼ºå¤±å€¼ï¼‰ã€‚ç”¨ Pandas DataFrame å†…ç½®çš„ isnull()æ–¹æ³•ï¼š
>
> å¾ˆå¥½ï¼æ•°æ®ä¸­æ²¡æœ‰ç¼ºå¤±å€¼ã€‚ç»§ç»­æ¢ç´¢æ•°æ®ï¼Œé¦–å…ˆç”¨ shape æ–¹æ³•çœ‹çœ‹æ•°æ®çš„è¡Œæ•°å’Œåˆ—æ•°ï¼š
>
> æˆ‘ä»¬ç¡®å®šæ•°æ®æœ‰ 9 åˆ—ï¼ˆåŒ…æ‹¬è¦é¢„æµ‹çš„å˜é‡ï¼‰å’Œ 768 ä¸ªè§‚å¯Ÿå€¼ï¼ˆè¡Œï¼‰ã€‚ç”¨ä¸‹é¢çš„ä»£ç çœ‹çœ‹ç³–å°¿ ç—…çš„å‘ç—…ç‡ï¼š
>
> DataFrame å†…ç½®çš„ describe æ–¹æ³•å¯ä»¥æä¾›æ•°æ® åŸºæœ¬çš„æè¿°æ€§ç»Ÿè®¡ï¼š

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/7ns1Id.png)

> â€¼ï¸ å› ä¸º onset_diabetes ä¸­çš„ 0 ä»£è¡¨æ²¡æœ‰ç³–å°¿ç—…ï¼Œäººä¹Ÿå¯ä»¥æ€€å­• 0 æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥**å¾—å‡ºç»“è®ºï¼Œ ä¸‹é¢è¿™äº›åˆ—ä¸­çš„ç¼ºå¤±å€¼ç”¨ 0 å¡«å……äº†**ï¼šplasma_glucose_concentrationã€diastolic_blood_pressureã€triceps_thicknessã€serum_insulinã€bmi

> âš ï¸ **æ•°æ®ä¸­è¿˜æ˜¯å­˜åœ¨ç¼ºå¤±å€¼çš„ï¼æˆ‘ä»¬å·²ç»çŸ¥é“ç¼ºå¤±çš„æ•°æ®ç”¨ 0 å¡«å……è¿‡äº†ï¼ŒçœŸä¸èµ°è¿**ã€‚ä½œä¸ºæ•°æ®ç§‘å­¦å®¶ï¼Œä½ å¿…é¡»æ—¶åˆ»ä¿æŒè­¦æƒ•ï¼Œå°½å¯èƒ½åœ°äº†è§£æ•°æ®é›†ï¼Œä»¥ä¾¿æ‰¾åˆ°ä½¿ç”¨å…¶ä»–ç¬¦å·å¡«å……çš„ç¼ºå¤±æ•°æ®ã€‚

### 3ï¼‰å¤„ç†æ•°æ®é›†ä¸­çš„ç¼ºå¤±å€¼

> è™½ç„¶åŠæ³•æœ‰å¾ˆå¤šå˜ç§ï¼Œ ä½†æ˜¯ä¸¤ä¸ªæœ€ä¸»è¦çš„å¤„ç†æ–¹æ³•æ˜¯ï¼š
>
> 1ï¼‰åˆ é™¤ç¼ºå°‘å€¼çš„è¡Œï¼›
>
> 2ï¼‰å¡«å……ç¼ºå¤±å€¼ã€‚

> åœ¨è¿›ä¸€æ­¥å¤„ç†å‰ï¼Œå…ˆç”¨Pythonä¸­çš„ None å¡«å……æ‰€æœ‰çš„æ•°å­—0ï¼Œè¿™æ ·Pandasçš„ fillna å’Œ dropnaæ–¹æ³•å°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†

```python
# ç›´æ¥å¯¹æ‰€æœ‰åˆ—æ“ä½œï¼Œå¿«ä¸€äº›
columns = ['serum_insulin', 'bmi', 'plasma_glucose_concentration', 'diastolic_blood_pressure', 'triceps_thickness']

for col in columns:
		pima[col].replace([0], [None], inplace=True)
    
pima.isnull().sum()
# ç°åœ¨æœ‰æ„ä¹‰å¤šäº†
times_pregnant                0
plasma_glucose_concentration  5
diastolic_blood_pressure      35
triceps_thickness             227
serum_insulin                 374
bmi                           11
pedigree_function             0
age                           0
onset_diabetes                0
dtype: int64
```

> ç°åœ¨æ•°æ®æœ‰æ„ä¹‰å¤šäº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹è§å…¶ä¸­ 5 åˆ—æœ‰ç¼ºå¤±å€¼ï¼Œ**ç¼ºå¤±ç¨‹åº¦æœ‰æ‰€ä¸åŒ**ã€‚æœ‰äº›åˆ—ï¼Œä¾‹å¦‚ plasma_glucose_concentration åªç¼ºå°‘ 5 ä¸ªå€¼ï¼Œä½†æ˜¯ serum_insulin å·®ä¸å¤šä¸€åŠçš„å€¼éƒ½æ˜¯ ç¼ºå¤±çš„ã€‚

> æˆ‘ä»¬å·²ç»å°†ç¼ºå¤±å€¼æ­£ç¡®æ’å…¥äº†æ•°æ®é›†ï¼Œç¼ºå¤±æ•°æ®ä¸å†æ˜¯åŸæ¥çš„å ä½ç¬¦ 0ã€‚è¿™æ ·**æ¢ç´¢æ€§æ•°æ®åˆ†æä¹Ÿä¼šæ›´å‡†ç¡®**ï¼š
>
> âš ï¸ æ³¨æ„ describe æ–¹æ³•ä¸åŒ…æ‹¬æœ‰ç¼ºå¤±å€¼çš„åˆ—ã€‚

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/VAB96i.png)

#### 3.1 åˆ é™¤æœ‰å®³çš„è¡Œ

> åœ¨å¤„ç†ç¼ºå¤±æ•°æ®çš„ä¸¤ç§åŠæ³•ä¸­ï¼Œæœ€å¸¸è§ä¹Ÿæœ€å®¹æ˜“çš„æ–¹æ³•å¤§æ¦‚æ˜¯ç›´æ¥åˆ é™¤å­˜åœ¨ç¼ºå¤±å€¼çš„è¡Œã€‚é€šè¿‡è¿™ç§æ“ä½œï¼Œæˆ‘ä»¬ä¼šç•™ä¸‹å…·æœ‰æ•°æ®çš„å®Œæ•´æ•°æ®ç‚¹ã€‚å¯ä»¥åœ¨ Pandas ä¸­åˆ©ç”¨ dropna æ–¹æ³•è·å–æ–°çš„ DataFrameï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
# åˆ é™¤å­˜åœ¨ç¼ºå¤±å€¼çš„è¡Œ 
pima_dropped = pima.dropna()
num_rows_lost = round(100*(pima.shape[0] - pima_dropped.shape[0])/float(pima.shape[0]))
print("retained {}% of rows".format(num_rows_lost))
>>> retained 49% of rows
```

> âš ï¸ **æˆ‘ä»¬ä¸¢å¤±äº†åŸå§‹æ•°æ®é›†ä¸­å¤§çº¦ 51%çš„è¡Œï¼**ä»æœºå™¨å­¦ä¹ çš„è§’åº¦è€ƒè™‘ï¼Œå°½ç®¡æ•°æ®éƒ½æœ‰å€¼ã€å¾ˆå¹²å‡€ï¼Œ ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰åˆ©ç”¨å°½å¯èƒ½å¤šçš„æ•°æ®ï¼Œå¿½ç•¥äº†ä¸€åŠä»¥ä¸Šçš„è§‚å¯Ÿå€¼ã€‚å°±åƒåŒ»ç”Ÿåœ¨ç ”ç©¶å¿ƒè„ç—…å‘ä½œåŸç† æ—¶ï¼Œå¿½ç•¥äº†ä¸€åŠä»¥ä¸Šçš„æ‚£è€…ã€‚

> ä¸‹é¢å¯¹æ•°æ®é›†åšè¿›ä¸€æ­¥çš„æ¢ç´¢æ€§æ•°æ®åˆ†æï¼Œ**æ¯”è¾ƒä¸€ä¸‹ä¸¢å¼ƒç¼ºå¤±å€¼å‰åçš„ç»Ÿè®¡æ•°æ®**ï¼š

```python
# ä¸¢å¼ƒç¼ºå¤±å€¼å‰åçš„æ¢ç´¢æ€§æ•°æ®åˆ†æ
# åˆ†æˆ True å’Œ False ä¸¤ç»„ 
pima['onset_diabetes'].value_counts(normalize=True)

>>> 0 0.651042 
    1 0.348958 
    Name: onset_diabetes, dtype: float64

# çœ‹ä¸€ä¸‹ä¸¢å¼ƒæ•°æ®åçš„ç»Ÿè®¡æ•°æ®ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š
pima_dropped['onset_diabetes'].value_counts(normalize=True)

>>> 0 0.668367 
		1 0.331633 
		Name: onset_diabetes, dtype: float64
```

> å‰åçš„ True å’Œ False æ¯”ä¾‹å·®ä¸å¤šã€‚åœ¨å¤§åˆ€é˜”æ–§çš„è½¬æ¢åï¼ŒäºŒå…ƒå“åº”çœ‹èµ·æ¥æ²¡ä»€ä¹ˆå˜åŒ–ã€‚æˆ‘ä»¬ç”¨ pima.mean å‡½æ•°æ¯”è¾ƒä¸€ä¸‹è½¬æ¢ å‰ååˆ—çš„å‡å€¼ï¼Œçœ‹çœ‹æ•°æ®çš„å½¢çŠ¶ï¼Œç»“æœå¦‚ä¸‹ï¼š

| <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/Dz5SdL.png" style="zoom:50%;" /> | <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/2BCLon.png" style="zoom:50%;" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|                         ä¸¢å¼ƒç¼ºå¤±å€¼å‰                         |                         ä¸¢å¼ƒç¼ºå¤±å€¼å                         |
| <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/WMcFPs.png" style="zoom:50%;" /> | <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/pYCwo4.png" style="zoom:50%;" /> |
|                    å‡å€¼å˜åŒ–çš„ç™¾åˆ†æ¯”å¯è§†åŒ–                    |                     å‡å€¼å˜åŒ–ç™¾åˆ†æ¯”æ¡å½¢å›¾                     |

> ä¸ºäº†æ›´å¥½åœ°äº†è§£è¿™äº›æ•°çš„å˜åŒ–ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°å›¾è¡¨ï¼Œå°†æ¯åˆ—å‡å€¼å˜åŒ–çš„ç™¾åˆ†æ¯”å¯è§†åŒ–ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ—å‡ºæ¯åˆ—å‡å€¼å˜åŒ–çš„ç™¾åˆ†æ¯”
>
> ```python
> # å‡å€¼å˜åŒ–ç™¾åˆ†æ¯” 
> (pima_dropped.mean() - pima.mean()) / pima.mean()
> ```
>
> ç°åœ¨ç”¨æ¡å½¢å›¾å¯¹è¿™äº›å˜åŒ–è¿›è¡Œå¯è§†åŒ–ï¼š
>
> ```python
> # å‡å€¼å˜åŒ–ç™¾åˆ†æ¯”æ¡å½¢å›¾ 
> ax = ((pima_dropped.mean() - pima.mean()) / pima.mean()).plot(kind='bar', title='% change in average column values') 
> ax.set_ylabel('% change')
> ```

> â€¼ï¸ å¯ä»¥çœ‹åˆ°ï¼Œtimes_pregnantï¼ˆæ€€å­•æ¬¡æ•°ï¼‰çš„å‡å€¼åœ¨åˆ é™¤ç¼ºå¤±å€¼å**ä¸‹é™äº† 14%ï¼Œå˜åŒ–å¾ˆå¤§**ï¼ pedigree_functionï¼ˆç³–å°¿ç—…è¡€ç³»åŠŸèƒ½ï¼‰ä¹Ÿ**ä¸Šå‡äº† 11%ï¼Œä¹Ÿæ˜¯ä¸ªé£è·ƒ**ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ**åˆ é™¤è¡Œï¼ˆè§‚ å¯Ÿå€¼ï¼‰ä¼šä¸¥é‡å½±å“æ•°æ®çš„å½¢çŠ¶ï¼Œæ‰€ä»¥åº”è¯¥ä¿ç•™å°½å¯èƒ½å¤šçš„æ•°æ®**ã€‚åœ¨ä»‹ç»ä¸‹ä¸€ä¸ªå¤„ç†æ–¹æ³•å‰ï¼Œæˆ‘ä»¬ å…ˆè¿›è¡Œä¸€äº›æœºå™¨å­¦ä¹ ã€‚

```python
# å¼€å§‹æœºå™¨å­¦ä¹ 
# æ³¨æ„ä½¿ç”¨åˆ é™¤ç¼ºå¤±å€¼åçš„æ•°æ®
from sklearn.neighbors import KNeighborsClassifier 
from sklearn.model_selection import GridSearchCV

X_dropped = pima_dropped.drop('onset_diabetes', axis=1) 
# åˆ é™¤å“åº”å˜é‡ï¼Œå»ºç«‹ç‰¹å¾çŸ©é˜µ 
print("learning from {} rows".format(X_dropped.shape[0]))

>>> learning from 392 rows

y_dropped = pima_dropped['onset_diabetes']
# ç½‘æ ¼æœç´¢æ‰€éœ€çš„å˜é‡å’Œå®ä¾‹
# éœ€è¦è¯•éªŒçš„ KNN æ¨¡å‹å‚æ•° 
knn_params = {'n_neighbors':[1, 2, 3, 4, 5, 6, 7]}
knn = KNeighborsClassifier() # è®¾ç½® KNN æ¨¡å‹
grid = GridSearchCV(knn, knn_params) 
grid.fit(X_dropped, y_dropped)
print(grid.best_score_, grid.best_params_) # ä½†æ˜¯æˆ‘ä»¬åªå­¦ä¹ äº†å¾ˆå°‘çš„è¡Œ

>>> 0.7448979591836735 {'n_neighbors': 7}
```

> âŒ ç°åœ¨å·²ç»çœ‹å‡ºé—®é¢˜äº†ï¼šæœºå™¨å­¦ä¹ ç®—æ³•ä½¿ç”¨çš„æ•°æ®æ¯”ä¸€å¼€å§‹æ‹¿åˆ°çš„æ•°æ®å°‘å¾—å¤šã€‚
>
> â­•ï¸ çœ‹æ¥ï¼Œæœ€å¥½çš„é‚»å±…æ•°æ˜¯ 7 ä¸ªï¼Œæ­¤æ—¶ KNN æ¨¡å‹çš„å‡†ç¡®ç‡æ˜¯ 74.5%ï¼ˆæ¯”ç©ºå‡†ç¡®ç‡ 65%å¥½ï¼‰ã€‚ä½†æ˜¯ è¦è®°ä½ï¼Œè¿™ä¸ªæ¨¡å‹åªç”¨äº† 49%çš„æ•°æ®ï¼Œ**å¦‚æœèƒ½ç”¨åˆ°æ‰€æœ‰æ•°æ®ï¼Œä¼šä¸ä¼šæ›´å¥½ä¸€äº›**ï¼Ÿ

#### 3.2 å¡«å……ç¼ºå¤±å€¼

> å¡«å……æ•°æ®æ˜¯å¤„ç†ç¼ºå¤±å€¼çš„ä¸€ç§æ›´å¤æ‚çš„æ–¹æ³•ã€‚å¡«å……æŒ‡çš„æ˜¯åˆ©ç”¨ç°æœ‰çŸ¥è¯†/æ•°æ®æ¥ç¡®å®šç¼ºå¤±çš„æ•° é‡å€¼å¹¶å¡«å……çš„è¡Œä¸ºã€‚æˆ‘ä»¬æœ‰å‡ ä¸ªé€‰æ‹©ï¼Œ**æœ€å¸¸è§çš„æ˜¯ç”¨æ­¤åˆ—å…¶ä½™éƒ¨åˆ†çš„å‡å€¼å¡«å……ç¼ºå¤±å€¼**ï¼Œè¿˜å¯ä»¥ç”¨ **scikit-learn é¢„å¤„ç†ç±»çš„ Imputer æ¨¡å—**ï¼ŒImputer åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè§£å†³äº†å¡«å……ç¼ºå¤±å€¼çš„çäº‹ã€‚

```python
imputer = Imputer(strategy='mean')
pima_imputed = imputer.fit_transform(pima) # ndarray
pima_imputed = pd.DataFrame(pima_imputed, columns=pima_column_names)
```

> æˆ‘ä»¬å°è¯•å¡«å……ä¸€äº›åˆ«çš„å€¼ï¼Œçœ‹ çœ‹å¯¹ KNN æ¨¡å‹çš„å½±å“ã€‚é¦–å…ˆå°è¯•ä¸€ç§æ›´ç®€å•çš„å¡«å……æ–¹æ³•ï¼Œç”¨ 0 æ›¿ä»£æ‰€æœ‰çš„ç¼ºå¤±å€¼ã€‚å®éªŒç»“è®ºï¼šç”¨ 0 å¡«å……å‡†ç¡®ç‡ä¸‹é™ï¼Œä¼šä½äºç›´æ¥åˆ æ‰æœ‰ç¼ºå¤±å€¼çš„è¡Œã€‚

> ğŸš« ä¸æ°å½“çš„åšæ³•ï¼šåœ¨åˆ’åˆ†å‰å¡«å……å€¼ã€‚
>
> â€¼ï¸ æ°å½“çš„åšæ³•ï¼šåœ¨åˆ’åˆ†åå¡«å……å€¼ã€‚æˆ‘ä»¬å…ˆè®¡ç®—å‡ºè®­ç»ƒé›†çš„å‡å€¼ï¼Œç„¶å**ç”¨è®­ç»ƒé›†çš„å‡å€¼å¡«å……è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„ç¼ºå¤±å€¼**ã€‚ è¿™ä¸ªè¿‡ç¨‹å†ä¸€æ¬¡æµ‹è¯•äº†æ¨¡å‹ç”¨è®­ç»ƒæ•°æ®çš„å‡å€¼é¢„æµ‹æœªçŸ¥æµ‹è¯•é›†çš„èƒ½åŠ›

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/lMLzUM.png)

#### 3.3 æ ‡å‡†åŒ–å’Œå½’ä¸€åŒ–

> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•è¯†åˆ«æ•°æ®ç±»å‹ï¼Œå¦‚ä½•è¯†åˆ«ç¼ºå¤±å€¼ï¼Œä»¥åŠå¦‚ä½•å¤„ç†ç¼ºå¤±å€¼ã€‚ ç°åœ¨ç»§ç»­è®¨è®ºå¦‚ä½•å¤„ç†æ•°æ®ï¼ˆå’Œç‰¹å¾ï¼‰ï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºæœºå™¨å­¦ä¹ æµæ°´çº¿ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»ç”¨è¿‡ 4 ç§ä¸åŒçš„æ–¹å¼å¤„ç†æ•°æ®é›†ï¼Œæœ€ä½³çš„ KNN äº¤å‰éªŒè¯å‡†ç¡®ç‡æ˜¯ 0.745ã€‚å¦‚æœå›å¤´çœ‹ä¹‹å‰çš„æ¢ç´¢æ€§æ•°æ® åˆ†æï¼Œä¼šå‘ç°ä¸€äº›ç‰¹å¾çš„æ€§è´¨ï¼š

```python
impute = Imputer(strategy='mean') 
# å¡«å……æ‰€æœ‰çš„ç¼ºå¤±å€¼
pima_imputed_mean = pd.DataFrame(impute.fit_transform(pima), columns=pima_column_names)
pima_imputed_mean.hist(figsize=(15, 15))
```

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/kchXGz.png)

> â€¼ï¸ å¾ˆå¥½ï¼Œ ä½†æ˜¯ä½ æ³¨æ„åˆ°ä»€ä¹ˆäº†å—ï¼Ÿ**æ¯åˆ—çš„å‡å€¼ã€æœ€å°å€¼ã€æœ€å¤§å€¼å’Œæ ‡å‡†å·®å·®åˆ«å¾ˆå¤§**ã€‚ é€šè¿‡ describe æ–¹æ³•ä¹Ÿå¯ä»¥çœ‹åˆ°å¾ˆæ˜æ˜¾çš„å·®åˆ«ï¼š

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/k5JCLH.png)

> âš ï¸ è¿™æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ**å› ä¸ºä¸€äº›æœºå™¨å­¦ä¹ æ¨¡å‹å—æ•°æ®å°ºåº¦ï¼ˆscaleï¼‰çš„å½±å“å¾ˆå¤§**ã€‚è¿™æ„å‘³ç€å¦‚æœ diastolic_blood_pressure åˆ—çš„èˆ’å¼ å‹åœ¨ 24ï½122ï¼Œä½†æ˜¯å¹´é¾„æ˜¯ 21ï½81ï¼Œé‚£ä¹ˆç®—æ³•ä¸ä¼šè¾¾åˆ° æœ€ä¼˜åŒ–çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç›´æ–¹å›¾æ–¹æ³•ä¸­è°ƒç”¨å¯é€‰çš„ sharex å’Œ sharey å‚æ•°ï¼Œåœ¨åŒä¸€æ¯”ä¾‹ä¸‹æŸ¥çœ‹ æ¯ä¸ªå›¾è¡¨ï¼š
>
> `pima_imputed_mean.hist(figsize=(15, 15), sharex=True) # x è½´ç›¸åŒï¼ˆy è½´ä¸é‡è¦ï¼‰`

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/2Za0En.png)

> â€¼ï¸ **å¾ˆæ˜æ˜¾ï¼Œæ‰€æœ‰çš„æ•°æ®å°ºåº¦éƒ½ä¸åŒ**ã€‚æ•°æ®å·¥ç¨‹å¸ˆå¯ä»¥é€‰ç”¨æŸç§å½’ä¸€åŒ–æ“ä½œï¼Œåœ¨æœºå™¨å­¦ä¹ æµæ°´ çº¿ä¸Šå¤„ç†è¯¥é—®é¢˜ã€‚**å½’ä¸€åŒ–æ“ä½œæ—¨åœ¨å°†è¡Œå’Œåˆ—å¯¹é½å¹¶è½¬åŒ–ä¸ºä¸€è‡´çš„è§„åˆ™**ã€‚ä¾‹å¦‚ï¼Œå½’ä¸€åŒ–çš„ä¸€ç§å¸¸ è§å½¢å¼æ˜¯å°†æ‰€æœ‰å®šé‡åˆ—è½¬åŒ–ä¸ºåŒä¸€ä¸ªé™æ€èŒƒå›´ä¸­çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰æ•°éƒ½ä½äº 0ï½1ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ ä»¥ä½¿ç”¨æ•°å­¦è§„åˆ™ï¼Œä¾‹å¦‚æ‰€æœ‰åˆ—çš„å‡å€¼å’Œæ ‡å‡†å·®å¿…é¡»ç›¸åŒï¼Œä»¥ä¾¿åœ¨åŒä¸€ä¸ªç›´æ–¹å›¾ä¸Šæ˜¾ç¤ºï¼ˆå’Œä¸Šé¢ çš®é©¬äººçš„ç›´æ–¹å›¾ä¸åŒï¼‰ã€‚æ ‡å‡†åŒ–é€šè¿‡ç¡®ä¿æ‰€æœ‰è¡Œå’Œåˆ—åœ¨æœºå™¨å­¦ä¹ ä¸­å¾—åˆ°å¹³ç­‰å¯¹å¾…ï¼Œè®©æ•°æ®çš„å¤„ç† ä¿æŒä¸€è‡´ã€‚

##### 3.3.1 z åˆ†æ•°æ ‡å‡†åŒ– $z=(x-\mu) / \sigma$

```python
# å†…ç½®çš„ z åˆ†æ•°å½’ä¸€åŒ– 
from sklearn.preprocessing import StandardScaler
# z åˆ†æ•°æ ‡å‡†åŒ–å‰çš„å‡å€¼å’Œæ ‡å‡†å·® 
pima['plasma_glucose_concentration'].mean(),
pima['plasma_glucose_concentration'].std()
>>> (121.68676277850591, 30.435948867207657)
ax = pima['plasma_glucose_concentration'].hist() 
ax.set_title('Distribution of plasma_glucose_concentration')

# å½’ä¸€åŒ–å
scaler = StandardScaler()
glucose_z_score_standardized = scaler.fit_transform(pima[['plasma_glucose_concentration']])
glucose_z_score_standardized.mean(), glucose_z_score_standardized.std()
>>> (-3.561965537339044e-16, 1.0)
```

| <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/q27OMi.png" style="zoom:50%;" /> | <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/7hpqj2.png" style="zoom:50%;" /> |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|                       å¤„ç†å‰çš„åˆ†å¸ƒæƒ…å†µ                       |                     ç¼©æ”¾åæ•°æ®çš„åˆ†å¸ƒæƒ…å†µ                     |

> æˆ‘ä»¬è§‚å¯Ÿåˆ° x è½´æ›´ç´§å¯†äº†ï¼Œy è½´åˆ™æ²¡æœ‰å˜åŒ–ã€‚æ³¨æ„ï¼Œ**æ•°æ®çš„å½¢çŠ¶æ²¡æœ‰å˜åŒ–**ã€‚

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/UCiY0W.png)

> ç°åœ¨æˆ‘ä»¬æ­£åœ¨å¯» æ‰¾ KNN ä¸­ç­–ç•¥å’Œé‚»å±…æ•°çš„æœ€ä½³ç»„åˆï¼Œ**ç›®å‰çš„å¾—åˆ†æ˜¯ 0.742ï¼Œè¿™æ˜¯è‡³ä»Šä¸ºæ­¢çš„æœ€ä½³å¾—åˆ†**ï¼Œæ¥è¿‘ç›®æ ‡ 0.745ã€‚è¿™æ¡æµæ°´çº¿ä»æ•´ä¸ª 768 è¡Œä¸­å­¦ä¹ ã€‚æˆ‘ä»¬ç°åœ¨çœ‹çœ‹å¦ä¸€ç§æ ‡å‡†åŒ–æ–¹æ³•ã€‚

##### 3.3.2 min-max æ ‡å‡†åŒ– $m=\left(x-x_{\min }\right) /\left(x_{\max }-x_{\min }\right)$

```python
# å¯¼å…¥ sklearn æ¨¡å— 
from sklearn.preprocessing import MinMaxScaler
# å®ä¾‹åŒ– min_max = MinMaxScaler()
# ä½¿ç”¨ min-max æ ‡å‡†åŒ– 
pima_min_maxed = pd.DataFrame(min_max.fit_transform(pima_imputed), columns=pima_column_names)
# å¾—åˆ°æè¿°æ€§ç»Ÿè®¡ 
pima_min_maxed.describe()
```

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/MZg8lj.png)

> âš ï¸ æ³¨æ„ï¼Œæœ€å°å€¼éƒ½æ˜¯ 0ï¼Œæœ€å¤§å€¼éƒ½æ˜¯ 1ã€‚**è¿›ä¸€æ­¥æ³¨æ„ï¼Œè¿™ç§ç¼©æ”¾çš„å‰¯ä½œç”¨æ˜¯æ ‡å‡†å·®éƒ½éå¸¸å°ã€‚è¿™ æœ‰å¯èƒ½ä¸åˆ©äºæŸäº›æ¨¡å‹ï¼Œå› ä¸ºå¼‚å¸¸å€¼çš„æƒé‡é™ä½äº†**ã€‚0.74609375ï¼Œè¿™æ˜¯è‡³ä»Šä½¿ç”¨åŒ…æ‹¬ç¼ºå¤±æ•°æ®çš„å…¨éƒ¨ 768 è¡Œçš„æœ€å¥½ç»“æœã€‚çœ‹èµ·æ¥ min-max ç¼©æ”¾å¯¹ KNN æœ‰å¾ˆå¤§ å¸®åŠ©ï¼

##### 3.3.3 è¡Œå½’ä¸€åŒ– 

> æœ€åè¿™ä¸ªæ ‡å‡†åŒ–æ–¹æ³•æ˜¯å…³äºè¡Œï¼Œè€Œä¸æ˜¯å…³äºåˆ—çš„ã€‚è¡Œå½’ä¸€åŒ–ä¸æ˜¯è®¡ç®—æ¯åˆ—çš„ç»Ÿè®¡å€¼ï¼ˆå‡å€¼ã€ æœ€å°å€¼ã€æœ€å¤§å€¼ç­‰ï¼‰ï¼Œè€Œæ˜¯ä¼šä¿è¯æ¯è¡Œæœ‰å•ä½èŒƒæ•°ï¼ˆunit normï¼‰ï¼Œæ„å‘³ç€æ¯è¡Œçš„å‘é‡é•¿åº¦ç›¸åŒã€‚æƒ³ è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ¯è¡Œæ•°æ®éƒ½åœ¨ä¸€ä¸ª n ç»´ç©ºé—´å†…ï¼Œé‚£ä¹ˆæ¯è¡Œéƒ½æœ‰ä¸€ä¸ªå‘é‡èŒƒæ•°ï¼ˆé•¿åº¦ï¼‰ã€‚**æˆ‘ä»¬è®¤ä¸ºæ¯è¡Œéƒ½æ˜¯ç©ºé—´å†…çš„ä¸€ä¸ªå‘é‡**ã€‚

![](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/rhCuhl.png)

## ç‰¹å¾æ„å»ºï¼šæˆ‘èƒ½ç”Ÿæˆæ–°ç‰¹å¾å—?

> åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å€ŸåŠ©â€œçš®é©¬å°ç¬¬å®‰äººç³–å°¿ç—…é¢„æµ‹æ•°æ®é›†â€ç†è§£äº†å“ªäº›ç°æœ‰ç‰¹å¾æœ€æœ‰ä»·å€¼ã€‚ åœ¨ä½¿ç”¨ç°æœ‰ç‰¹å¾æ—¶ï¼Œæˆ‘ä»¬è¯†åˆ«äº†å„åˆ—çš„ç¼ºå¤±å€¼ï¼Œä½¿ç”¨ä¸åŒçš„æ–¹æ³•åˆ é™¤æˆ–å¡«å……äº†ç¼ºå¤±å€¼ï¼Œå¹¶å¯¹æ•°æ® è¿›è¡Œæ ‡å‡†åŒ–/å½’ä¸€åŒ–ï¼Œä»è€Œæé«˜äº†æœºå™¨å­¦ä¹ æ¨¡å‹çš„å‡†ç¡®ç‡ã€‚

> æœ¬ç« æ¦‚è¦ï¼š
>
> 1ï¼‰æ£€æŸ¥æ•°æ®é›†ï¼› 
>
> 2ï¼‰å¡«å……åˆ†ç±»ç‰¹å¾ï¼› 
>
> 3ï¼‰ç¼–ç åˆ†ç±»å˜é‡ï¼› 
>
> 4ï¼‰æ‰©å±•æ•°å€¼ç‰¹å¾ï¼› 
>
> 5ï¼‰é’ˆå¯¹æ–‡æœ¬çš„ç‰¹å¾æ„å»ºã€‚

### 2ï¼‰å¡«å……åˆ†ç±»ç‰¹å¾

> æˆ‘ä»¬è¦å†™ä¸€ä¸ª è‡ªå·±çš„è½¬æ¢å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¡«å……æ¯åˆ—ç¼ºå¤±å€¼çš„æ–¹æ³•ã€‚
>
> æˆ‘ä»¬å…ˆä»å®šæ€§åˆ— city å¼€å§‹ã€‚å¯¹äº**æ•°å€¼æ•°æ®**ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—**å‡å€¼**çš„æ–¹æ³•å¡«å……ç¼ºå¤±å€¼ï¼›è€Œå¯¹äº **åˆ†ç±»æ•°æ®**ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ç±»ä¼¼çš„å¤„ç†æ–¹æ³•ï¼šè®¡ç®—å‡º**æœ€å¸¸è§çš„ç±»åˆ«**ç”¨äºå¡«å……ã€‚
>
> `X['city'].fillna(X['city'].value_counts().index[0])`

#### è‡ªå®šä¹‰åˆ†ç±»å¡«å……å™¨

> é¦–å…ˆï¼Œç”¨ scikit-learn çš„ TransformerMixin åŸºç±»åˆ›å»ºæˆ‘ä»¬çš„è‡ªå®šä¹‰åˆ†ç±»å¡«å……å™¨ã€‚è¿™ä¸ªè½¬æ¢ å™¨ï¼ˆä»¥åŠæœ¬ç« ä¸­çš„å…¶ä»–è½¬æ¢å™¨ï¼‰ä¼šä½œä¸ºæµæ°´çº¿çš„ä¸€ç¯ï¼Œå®ç° fit å’Œ transform æ–¹æ³•ã€‚

```python
from sklearn.base import TransformerMixin

class CustomCategoryImputer(TransformerMixin):
    def __init__(self, cols=None):
    		self.cols = cols
    		
    def transform(self, df):
    		X = df.copy() for col in self.cols:
    		X[col].fillna(X[col].value_counts().index[0], inplace=True) 
    		return X
    		
    def fit(self, *_):
    		return self
```

> æˆ‘ä»¬çš„ city å’Œ boolean åˆ—éƒ½æ²¡æœ‰ç¼ºå¤±å€¼äº†ã€‚ä¸è¿‡**å®šé‡åˆ—**è¿˜æ˜¯æœ‰ç¼ºå¤±å€¼ã€‚æ—¢ç„¶é»˜ è®¤çš„å¡«å……å™¨ä¸èƒ½é€‰æ‹©åˆ—ï¼Œæˆ‘ä»¬å†æ¥è‡ªå®šä¹‰ä¸€ä¸ªã€‚

#### è‡ªå®šä¹‰å®šé‡å¡«å……å™¨

> æˆ‘ä»¬ä½¿ç”¨çš„ç»“æ„å’Œè‡ªå®šä¹‰åˆ†ç±»å¡«å……å™¨ç±»ä¼¼ã€‚ä¸»è¦çš„åŒºåˆ«åœ¨äºï¼Œæ­¤å¤„ç”¨ scikit-learn çš„ Imputer ç±»å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„è½¬æ¢å™¨ï¼Œå¯¹åˆ—è¿›è¡Œè½¬æ¢ï¼š

```
from sklearn.preprocessing import Imputer 

class CustomQuantitativeImputer(TransformerMixin):
		def __init__(self, cols=None, strategy='mean'):
				self.cols = cols 
				self.strategy = strategy

		def transform(self, df):
				X = df.copy() 
				impute = Imputer(strategy=self.strategy) 
				for col in self.cols:
						X[col] = impute.fit_transform(X[[col]]) 
        return X

		def fit(self, *_):
				return self
```



